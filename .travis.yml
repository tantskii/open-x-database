language: cpp
sudo: required
dist: bionic
compiler:
  - clang
git:
  - submodules: false
before_install:
  - sed -i 's/git@github.com:/git:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
install:
  - DEPS_DIR="${TRAVIS_BUILD_DIR}/deps"
  - mkdir ${DEPS_DIR} && cd ${DEPS_DIR}
  - travis_retry wget --no-check-certificate https://cmake.org/files/v3.15/cmake-3.15.4-Linux-x86_64.tar.gz
  - tar -xvf cmake-3.15.4-Linux-x86_64.tar.gz > /dev/null
  - mv cmake-3.15.4-Linux-x86_64 cmake-install
  - PATH=${DEPS_DIR}/cmake-install:${DEPS_DIR}/cmake-install/bin:$PATH
  - cd ${TRAVIS_BUILD_DIR}
  - wget https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2
  - tar --bzip2 -xf boost_1_77_0.tar.bz2
before_script:
  - sudo apt-get update -qq
script:
  - mkdir build
  - cd build
  - cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${TRAVIS_BUILD_DIR}/install -DBOOST_ROOT=../boost_1_77_0
  - cmake --build . --target install
  - cd ${TRAVIS_BUILD_DIR}/install
  - ./bin/omxdb-test